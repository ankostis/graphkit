language: python
python:
- '3.6'
- '3.7'
addons:
  apt:
    packages:
    - graphviz
install:
- pip install Sphinx codecov packaging
- 'python -c $''import os, packaging.version as version\nv = version.parse(os.environ.get("TRAVIS_TAG",
  "1.0")).public\nwith open("VERSION", "w") as f: f.write(v)'''
- pip install -e .[test]
- cd docs
- make clean html
- cd ..
script:
- |
  if [[ "$TRAVIS_PYTHON_VERSION" = '3.7' ]]; then
    pytest --cov=graphtik -m 'slow or not slow' --log-level=DEBUG
  else
    # Undo configs in setup.cfg
    echo -e '[pytest]\nmarkers: slow' > pytest.ini
    pytest  --log-level=DEBUG --cov=graphtik
  fi
deploy:
  provider: pypi
  user: __token__
  password: "pypi-AgEIcHlwaS5vcmcCJDNjNDc4YzFiLTllZjAtNDcyZi1hYWRjLTU2YzRhMmVjMTMzOAACOXsicGVybWlzc2lvbnMiOiB7InByb2plY3RzIjogWyJncmFwaHRpayJdfSwgInZlcnNpb24iOiAxfQAABiA7Xh6TmWlv3dMLtOkE7Izr8lG53cUQh14mbII4FtjPjg"
  on:
    repo: pygraphkit/graphtik
    branch: publish
    tags: true
    python: 3.7
after_success:
- codecov
